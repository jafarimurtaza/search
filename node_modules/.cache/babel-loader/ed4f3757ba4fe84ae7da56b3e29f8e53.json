{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\Murtaza Jafari\\\\Desktop\\\\product-search\\\\product\\\\searcbox\\\\src\\\\URLSync.js\";\n// /* eslint @typescript-eslint/camelcase: [\"error\", { allow: [\"free_shipping\"] }], complexity: off */\nimport React, { Component } from 'react';\nimport qs from 'qs';\nconst updateAfter = 700;\nconst routeStateDefaultValues = {\n  query: '',\n  page: '1',\n  brands: undefined,\n  category: '',\n  rating: '',\n  price: '',\n  free_shipping: 'false',\n  sortBy: 'instant_search',\n  hitsPerPage: '20'\n};\nconst encodedCategories = {\n  Cameras: 'Cameras & Camcorders',\n  Cars: 'Car Electronics & GPS',\n  Phones: 'Cell Phones',\n  TV: 'TV & Home Theater'\n};\nconst decodedCategories = Object.keys(encodedCategories).reduce((acc, key) => {\n  const newKey = encodedCategories[key];\n  const newValue = key;\n  return { ...acc,\n    [newKey]: newValue\n  };\n}, {}); // Returns a slug from the category name.\n// Spaces are replaced by \"+\" to make\n// the URL easier to read and other\n// characters are encoded.\n\nfunction getCategorySlug(name) {\n  const encodedName = decodedCategories[name] || name;\n  return encodedName.replace(/ > /g, '/').split(' ').map(encodeURIComponent).join('+');\n} // Returns a name from the category slug.\n// The \"+\" are replaced by spaces and other\n// characters are decoded.\n\n\nfunction getCategoryName(slug) {\n  const decodedSlug = encodedCategories[slug] || slug;\n  return decodedSlug.split('+').map(decodeURIComponent).join(' ').replace(/\\//g, ' > ');\n}\n\nconst searchStateToURL = searchState => {\n  const routeState = {\n    query: searchState.query,\n    page: String(searchState.page),\n    brands: searchState.refinementList && searchState.refinementList.brand,\n    category: searchState.hierarchicalMenu && searchState.hierarchicalMenu['hierarchicalCategories.lvl0'],\n    rating: searchState.range && searchState.range.rating && String(searchState.range.rating.min),\n    price: searchState.range && searchState.range.price && `${searchState.range.price.min || ''}:${searchState.range.price.max || ''}`,\n    free_shipping: searchState.toggle && String(searchState.toggle.free_shipping) || undefined,\n    sortBy: searchState.sortBy,\n    hitsPerPage: searchState.hitsPerPage && String(searchState.hitsPerPage) || undefined\n  };\n  const {\n    protocol,\n    hostname,\n    port = '',\n    pathname,\n    hash\n  } = location;\n  const portWithPrefix = port === '' ? '' : `:${port}`;\n  const urlParts = location.href.match(/^(.*?)\\/search/);\n  const baseUrl = urlParts && urlParts[0] || `${protocol}//${hostname}${portWithPrefix}${pathname}search`;\n  const categoryPath = routeState.category ? `${getCategorySlug(routeState.category)}/` : '';\n  const queryParameters = {};\n\n  if (routeState.query && routeState.query !== routeStateDefaultValues.query) {\n    queryParameters.query = encodeURIComponent(routeState.query);\n  }\n\n  if (routeState.page && routeState.page !== routeStateDefaultValues.page) {\n    queryParameters.page = routeState.page;\n  }\n\n  if (routeState.brands && routeState.brands !== routeStateDefaultValues.brands) {\n    queryParameters.brands = routeState.brands.map(encodeURIComponent);\n  }\n\n  if (routeState.rating && routeState.rating !== routeStateDefaultValues.rating) {\n    queryParameters.rating = routeState.rating;\n  }\n\n  if (routeState.price && routeState.price !== routeStateDefaultValues.price) {\n    queryParameters.price = routeState.price;\n  }\n\n  if (routeState.free_shipping && routeState.free_shipping !== routeStateDefaultValues.free_shipping) {\n    queryParameters.free_shipping = routeState.free_shipping;\n  }\n\n  if (routeState.sortBy && routeState.sortBy !== routeStateDefaultValues.sortBy) {\n    queryParameters.sortBy = routeState.sortBy;\n  }\n\n  if (routeState.hitsPerPage && routeState.hitsPerPage !== routeStateDefaultValues.hitsPerPage) {\n    queryParameters.hitsPerPage = routeState.hitsPerPage;\n  }\n\n  const queryString = qs.stringify(queryParameters, {\n    addQueryPrefix: true,\n    arrayFormat: 'repeat'\n  });\n  return `${baseUrl}/${categoryPath}${queryString}${hash}`;\n};\n\nconst urlToSearchState = location => {\n  const pathnameMatches = location.pathname.match(/search\\/(.*?)\\/?$/);\n  const category = getCategoryName(pathnameMatches && pathnameMatches[1] || '');\n  const queryParameters = qs.parse(location.search.slice(1));\n  const {\n    query = '',\n    page = 1,\n    brands = [],\n    price,\n    free_shipping,\n    hitsPerPage,\n    sortBy,\n    rating\n  } = queryParameters; // `qs` does not return an array when there's a single value.\n\n  const allBrands = Array.isArray(brands) ? brands : [brands].filter(Boolean);\n  const searchState = {\n    range: {}\n  };\n\n  if (query) {\n    searchState.query = decodeURIComponent(query);\n  }\n\n  if (page) {\n    searchState.page = page;\n  }\n\n  if (category) {\n    searchState.hierarchicalMenu = {\n      'hierarchicalCategories.lvl0': category\n    };\n  }\n\n  if (allBrands.length) {\n    searchState.refinementList = {\n      brand: allBrands.map(decodeURIComponent)\n    };\n  }\n\n  if (rating) {\n    searchState.range.rating = {\n      min: Number(rating)\n    };\n  }\n\n  if (price) {\n    const [min, max = undefined] = price.split(':');\n    searchState.range.price = {\n      min: min || undefined,\n      max: max || undefined\n    };\n  }\n\n  if (free_shipping) {\n    searchState.toggle = {\n      free_shipping: Boolean(free_shipping)\n    };\n  }\n\n  if (sortBy) {\n    searchState.sortBy = sortBy;\n  }\n\n  if (hitsPerPage) {\n    searchState.hitsPerPage = hitsPerPage;\n  }\n\n  return searchState;\n};\n\nconst withURLSync = App => {\n  var _temp;\n\n  return _temp = class WithURLSync extends Component {\n    constructor(...args) {\n      super(...args);\n      this.state = {\n        searchState: urlToSearchState(window.location)\n      };\n\n      this.onPopState = ({\n        state\n      }) => this.setState({\n        searchState: state || {}\n      });\n\n      this.onSearchStateChange = searchState => {\n        clearTimeout(this.debouncedSetState);\n        this.debouncedSetState = setTimeout(() => {\n          window.history.pushState(searchState, null, searchStateToURL(searchState));\n        }, updateAfter);\n        this.setState({\n          searchState\n        });\n      };\n    }\n\n    componentDidMount() {\n      window.addEventListener('popstate', this.onPopState);\n    }\n\n    componentWillUnmount() {\n      clearTimeout(this.debouncedSetState);\n      window.removeEventListener('popstate', this.onPopState);\n    }\n\n    render() {\n      const {\n        searchState\n      } = this.state;\n      return /*#__PURE__*/_jsxDEV(App, { ...this.props,\n        searchState: searchState,\n        onSearchStateChange: this.onSearchStateChange,\n        createURL: searchStateToURL\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this);\n    }\n\n  }, _temp;\n};\n\nexport default withURLSync;","map":{"version":3,"sources":["C:/Users/Murtaza Jafari/Desktop/product-search/product/searcbox/src/URLSync.js"],"names":["React","Component","qs","updateAfter","routeStateDefaultValues","query","page","brands","undefined","category","rating","price","free_shipping","sortBy","hitsPerPage","encodedCategories","Cameras","Cars","Phones","TV","decodedCategories","Object","keys","reduce","acc","key","newKey","newValue","getCategorySlug","name","encodedName","replace","split","map","encodeURIComponent","join","getCategoryName","slug","decodedSlug","decodeURIComponent","searchStateToURL","searchState","routeState","String","refinementList","brand","hierarchicalMenu","range","min","max","toggle","protocol","hostname","port","pathname","hash","location","portWithPrefix","urlParts","href","match","baseUrl","categoryPath","queryParameters","queryString","stringify","addQueryPrefix","arrayFormat","urlToSearchState","pathnameMatches","parse","search","slice","allBrands","Array","isArray","filter","Boolean","length","Number","withURLSync","App","WithURLSync","state","window","onPopState","setState","onSearchStateChange","clearTimeout","debouncedSetState","setTimeout","history","pushState","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","render","props"],"mappings":"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","sourcesContent":["// /* eslint @typescript-eslint/camelcase: [\"error\", { allow: [\"free_shipping\"] }], complexity: off */\r\n\r\nimport React, { Component } from 'react';\r\nimport qs from 'qs';\r\n\r\nconst updateAfter = 700;\r\n\r\nconst routeStateDefaultValues = {\r\n  query: '',\r\n  page: '1',\r\n  brands: undefined,\r\n  category: '',\r\n  rating: '',\r\n  price: '',\r\n  free_shipping: 'false',\r\n  sortBy: 'instant_search',\r\n  hitsPerPage: '20',\r\n};\r\n\r\nconst encodedCategories = {\r\n  Cameras: 'Cameras & Camcorders',\r\n  Cars: 'Car Electronics & GPS',\r\n  Phones: 'Cell Phones',\r\n  TV: 'TV & Home Theater',\r\n};\r\n\r\nconst decodedCategories = Object.keys(encodedCategories).reduce((acc, key) => {\r\n  const newKey = encodedCategories[key];\r\n  const newValue = key;\r\n\r\n  return {\r\n    ...acc,\r\n    [newKey]: newValue,\r\n  };\r\n}, {});\r\n\r\n// Returns a slug from the category name.\r\n// Spaces are replaced by \"+\" to make\r\n// the URL easier to read and other\r\n// characters are encoded.\r\nfunction getCategorySlug(name) {\r\n  const encodedName = decodedCategories[name] || name;\r\n\r\n  return encodedName\r\n    .replace(/ > /g, '/')\r\n    .split(' ')\r\n    .map(encodeURIComponent)\r\n    .join('+');\r\n}\r\n\r\n// Returns a name from the category slug.\r\n// The \"+\" are replaced by spaces and other\r\n// characters are decoded.\r\nfunction getCategoryName(slug) {\r\n  const decodedSlug = encodedCategories[slug] || slug;\r\n\r\n  return decodedSlug\r\n    .split('+')\r\n    .map(decodeURIComponent)\r\n    .join(' ')\r\n    .replace(/\\//g, ' > ');\r\n}\r\n\r\nconst searchStateToURL = searchState => {\r\n  const routeState = {\r\n    query: searchState.query,\r\n    page: String(searchState.page),\r\n    brands: searchState.refinementList && searchState.refinementList.brand,\r\n    category:\r\n      searchState.hierarchicalMenu &&\r\n      searchState.hierarchicalMenu['hierarchicalCategories.lvl0'],\r\n    rating:\r\n      searchState.range &&\r\n      searchState.range.rating &&\r\n      String(searchState.range.rating.min),\r\n    price:\r\n      searchState.range &&\r\n      searchState.range.price &&\r\n      `${searchState.range.price.min || ''}:${searchState.range.price.max ||\r\n        ''}`,\r\n    free_shipping:\r\n      (searchState.toggle && String(searchState.toggle.free_shipping)) ||\r\n      undefined,\r\n    sortBy: searchState.sortBy,\r\n    hitsPerPage:\r\n      (searchState.hitsPerPage && String(searchState.hitsPerPage)) || undefined,\r\n  };\r\n\r\n  const { protocol, hostname, port = '', pathname, hash } = location;\r\n  const portWithPrefix = port === '' ? '' : `:${port}`;\r\n  const urlParts = location.href.match(/^(.*?)\\/search/);\r\n  const baseUrl =\r\n    (urlParts && urlParts[0]) ||\r\n    `${protocol}//${hostname}${portWithPrefix}${pathname}search`;\r\n\r\n  const categoryPath = routeState.category\r\n    ? `${getCategorySlug(routeState.category)}/`\r\n    : '';\r\n  const queryParameters = {};\r\n\r\n  if (routeState.query && routeState.query !== routeStateDefaultValues.query) {\r\n    queryParameters.query = encodeURIComponent(routeState.query);\r\n  }\r\n  if (routeState.page && routeState.page !== routeStateDefaultValues.page) {\r\n    queryParameters.page = routeState.page;\r\n  }\r\n  if (\r\n    routeState.brands &&\r\n    routeState.brands !== routeStateDefaultValues.brands\r\n  ) {\r\n    queryParameters.brands = routeState.brands.map(encodeURIComponent);\r\n  }\r\n  if (\r\n    routeState.rating &&\r\n    routeState.rating !== routeStateDefaultValues.rating\r\n  ) {\r\n    queryParameters.rating = routeState.rating;\r\n  }\r\n  if (routeState.price && routeState.price !== routeStateDefaultValues.price) {\r\n    queryParameters.price = routeState.price;\r\n  }\r\n  if (\r\n    routeState.free_shipping &&\r\n    routeState.free_shipping !== routeStateDefaultValues.free_shipping\r\n  ) {\r\n    queryParameters.free_shipping = routeState.free_shipping;\r\n  }\r\n  if (\r\n    routeState.sortBy &&\r\n    routeState.sortBy !== routeStateDefaultValues.sortBy\r\n  ) {\r\n    queryParameters.sortBy = routeState.sortBy;\r\n  }\r\n  if (\r\n    routeState.hitsPerPage &&\r\n    routeState.hitsPerPage !== routeStateDefaultValues.hitsPerPage\r\n  ) {\r\n    queryParameters.hitsPerPage = routeState.hitsPerPage;\r\n  }\r\n\r\n  const queryString = qs.stringify(queryParameters, {\r\n    addQueryPrefix: true,\r\n    arrayFormat: 'repeat',\r\n  });\r\n\r\n  return `${baseUrl}/${categoryPath}${queryString}${hash}`;\r\n};\r\n\r\nconst urlToSearchState = location => {\r\n  const pathnameMatches = location.pathname.match(/search\\/(.*?)\\/?$/);\r\n  const category = getCategoryName(\r\n    (pathnameMatches && pathnameMatches[1]) || ''\r\n  );\r\n  const queryParameters = qs.parse(location.search.slice(1));\r\n  const {\r\n    query = '',\r\n    page = 1,\r\n    brands = [],\r\n    price,\r\n    free_shipping,\r\n    hitsPerPage,\r\n    sortBy,\r\n    rating,\r\n  } = queryParameters;\r\n  // `qs` does not return an array when there's a single value.\r\n  const allBrands = Array.isArray(brands) ? brands : [brands].filter(Boolean);\r\n\r\n  const searchState = { range: {} };\r\n\r\n  if (query) {\r\n    searchState.query = decodeURIComponent(query);\r\n  }\r\n  if (page) {\r\n    searchState.page = page;\r\n  }\r\n  if (category) {\r\n    searchState.hierarchicalMenu = {\r\n      'hierarchicalCategories.lvl0': category,\r\n    };\r\n  }\r\n  if (allBrands.length) {\r\n    searchState.refinementList = {\r\n      brand: allBrands.map(decodeURIComponent),\r\n    };\r\n  }\r\n  if (rating) {\r\n    searchState.range.rating = {\r\n      min: Number(rating),\r\n    };\r\n  }\r\n  if (price) {\r\n    const [min, max = undefined] = price.split(':');\r\n    searchState.range.price = {\r\n      min: min || undefined,\r\n      max: max || undefined,\r\n    };\r\n  }\r\n  if (free_shipping) {\r\n    searchState.toggle = {\r\n      free_shipping: Boolean(free_shipping),\r\n    };\r\n  }\r\n  if (sortBy) {\r\n    searchState.sortBy = sortBy;\r\n  }\r\n\r\n  if (hitsPerPage) {\r\n    searchState.hitsPerPage = hitsPerPage;\r\n  }\r\n\r\n  return searchState;\r\n};\r\n\r\nconst withURLSync = App =>\r\n  class WithURLSync extends Component {\r\n    state = {\r\n      searchState: urlToSearchState(window.location),\r\n    };\r\n\r\n    componentDidMount() {\r\n      window.addEventListener('popstate', this.onPopState);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      clearTimeout(this.debouncedSetState);\r\n      window.removeEventListener('popstate', this.onPopState);\r\n    }\r\n\r\n    onPopState = ({ state }) =>\r\n      this.setState({\r\n        searchState: state || {},\r\n      });\r\n\r\n    onSearchStateChange = searchState => {\r\n      clearTimeout(this.debouncedSetState);\r\n\r\n      this.debouncedSetState = setTimeout(() => {\r\n        window.history.pushState(\r\n          searchState,\r\n          null,\r\n          searchStateToURL(searchState)\r\n        );\r\n      }, updateAfter);\r\n\r\n      this.setState({ searchState });\r\n    };\r\n\r\n    render() {\r\n      const { searchState } = this.state;\r\n\r\n      return (\r\n        <App\r\n          {...this.props}\r\n          searchState={searchState}\r\n          onSearchStateChange={this.onSearchStateChange}\r\n          createURL={searchStateToURL}\r\n        />\r\n      );\r\n    }\r\n  };\r\n\r\nexport default withURLSync;"]},"metadata":{},"sourceType":"module"}